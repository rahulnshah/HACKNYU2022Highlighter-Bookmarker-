chrome.runtime.onMessage.addListener(((e,r,t)=>{const{type:o,myUrl:n}=e;if("NEW"===o)document.addEventListener("mouseup",(function(){let e=window.getSelection().toString();e.length>0?chrome.storage.sync.get([n]).then((r=>{if(chrome.runtime.lastError)alert("Please Try Again. Error occurred:",chrome.runtime.lastError);else{let t=r[n]||[];if(t.find((r=>r===e)))alert(`The hightlight ${e} has been highlighted!`);else{t.push(e);const r={};r[n]=t,chrome.storage.sync.set(r).then((()=>{chrome.runtime.lastError?alert("Please Try Again. Error occurred:",chrome.runtime.lastError):alert(`The highlight '${e}' has been saved!`)}))}}})):alert("Please highlight something first!")})),document.addEventListener("mousedown",(function(){console.log("mouse down!")}));else if("DELETE"===o){let{myHighlightedText:r}=e;chrome.storage.sync.get([n]).then((e=>{if(chrome.runtime.lastError)alert("Please Try Again. Error occurred:",chrome.runtime.lastError);else{let o=e[n];o=o.filter((e=>e!==r));const s={};s[n]=o,chrome.storage.sync.set(s).then((()=>{chrome.runtime.lastError?alert("Please Try Again. Error occurred:",chrome.runtime.lastError):(alert(`The highlight ${r} has been deleted!`),t(o))}))}}))}}));